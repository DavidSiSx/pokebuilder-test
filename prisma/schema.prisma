generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Pokemon {
  id                  Int                   @id @default(autoincrement())
  nombre              String                @unique
  tipo1               String
  tipo2               String?
  hp_base             Int
  atk_base            Int
  def_base            Int
  spa_base            Int
  spd_base            Int
  spe_base            Int
  sprite_url          String?
  stats               Json?
  AnalisisEstrategico AnalisisEstrategico[]
  AnalisisMeta        AnalisisMeta[]
  builds              BuildCompetitiva[]
}

model Formato {
  id     Int                @id @default(autoincrement())
  nombre String             @unique
  reglas String?
  builds BuildCompetitiva[]
}

model Objeto {
  id     Int                @id @default(autoincrement())
  nombre String             @unique
  builds BuildCompetitiva[]
}

model Habilidad {
  id     Int                @id @default(autoincrement())
  nombre String             @unique
  builds BuildCompetitiva[]
}

model Movimiento {
  id        Int                 @id @default(autoincrement())
  nombre    String              @unique
  tipo      String
  categoria String
  potencia  Int?
  precision Int?
  builds    MovimientoEnBuild[]
}

model BuildCompetitiva {
  id          Int                 @id @default(autoincrement())
  pokemonId   Int
  formatoId   Int
  objetoId    Int?
  habilidadId Int
  rol         String
  naturaleza  String
  ev_hp       Int                 @default(0)
  ev_atk      Int                 @default(0)
  ev_def      Int                 @default(0)
  ev_spa      Int                 @default(0)
  ev_spd      Int                 @default(0)
  ev_spe      Int                 @default(0)
  formato     Formato             @relation(fields: [formatoId], references: [id])
  habilidad   Habilidad           @relation(fields: [habilidadId], references: [id])
  objeto      Objeto?             @relation(fields: [objetoId], references: [id])
  pokemon     Pokemon             @relation(fields: [pokemonId], references: [id])
  movimientos MovimientoEnBuild[]
}

model MovimientoEnBuild {
  buildId      Int
  movimientoId Int
  slot         Int
  build        BuildCompetitiva @relation(fields: [buildId], references: [id])
  movimiento   Movimiento       @relation(fields: [movimientoId], references: [id])

  @@id([buildId, movimientoId])
}

model AnalisisMeta {
  id                 String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pokemon_id         Int?
  formato_nombre     String?
  perfil_estrategico String?
  embedding          Unsupported("vector")?
  usage_score        Float?                 @default(0)
  tier               String?                @default("Unranked")
  Pokemon            Pokemon?               @relation(fields: [pokemon_id], references: [id])

  @@index([usage_score(sort: Desc)], map: "idx_analisis_meta_usage")
}

model AnalisisEstrategico {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pokemon_id Int?
  contenido  String?
  Pokemon    Pokemon? @relation(fields: [pokemon_id], references: [id])
}
